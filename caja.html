<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>MRS TPV Â· Caja</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
</head>
<body>

<nav class="container-fluid">
  <ul>
    <li><strong>MRS TPV</strong></li>
  </ul>
  <ul>
    <li id="rol-info"></li>
    <li><a href="historial.html">Historial</a></li>
    <li><a href="exportes.html" id="exportes-link">Exportes</a></li>
    <li><a href="configuracion.html" id="config-link">ConfiguraciÃ³n</a></li>
    <li><a href="#" onclick="logout()" role="button">Cerrar sesiÃ³n</a></li>
  </ul>
</nav>

<section id="abrir-caja" class="container" style="display:none;margin-top:2rem;">
  <article>
    <h3>Abrir caja</h3>
    <label>Fondo inicial (â‚¬)
      <input type="number" id="fondo-inicial" step="0.01">
    </label>
    <button onclick="abrirCaja()">ðŸŸ¢ Abrir caja</button>
  </article>
</section>

<div id="zona-caja" style="display:none;">
  <main class="container">
    <div class="grid">
      <section>
        <h3>Venta actual</h3>
        <table>
          <thead>
            <tr><th>Producto</th><th>Cant.</th><th>Total</th></tr>
          </thead>
          <tbody id="venta-lista"></tbody>
        </table>

        <p>Subtotal: <strong id="subtotal">0.00 â‚¬</strong></p>
        <p>IVA: <strong id="total-iva">0.00 â‚¬</strong></p>
        <p>Recargo: <strong id="total-recargo">0.00 â‚¬</strong></p>
        <h4>Total: <span id="total-venta">0.00 â‚¬</span></h4>
      </section>

      <section>
        <h3>CategorÃ­as</h3>
        <div id="categorias"></div>

        <h3>Productos</h3>
        <div id="productos"></div>
      </section>
    </div>
  </main>

  <hr>

  <h4>Forma de pago</h4>
  <button onclick="seleccionarPago('efectivo')">ðŸ’¶ Efectivo</button>
  <button onclick="seleccionarPago('tarjeta')">ðŸ’³ Tarjeta</button>

  <p>Seleccionado: <strong id="pago-seleccionado">â€”</strong></p>

  <div id="bloque-efectivo" style="display:none;">
    <label>Entregado
      <input type="number" id="efectivo-entregado" step="0.01" oninput="calcularCambio()">
    </label>
    <p>Cambio: <strong id="cambio">0.00 â‚¬</strong></p>
  </div>

  <button onclick="guardarVenta()">ðŸ’¾ Cobrar / Guardar venta</button>
</div>

<script src="js/auth.js" type="module"></script>
<script src="js/caja.js" type="module"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const rol = sessionStorage.getItem("rol");
  if (!rol) return location.href = "login.html";
  document.getElementById("rol-info").innerText = "Rol: " + rol;
  if (rol !== "admin") {
    document.getElementById("config-link").style.display = "none";
    document.getElementById("exportes-link").style.display = "none";
  }
});
</script>

</body>
</html>
